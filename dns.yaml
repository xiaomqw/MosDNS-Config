plugins:
  ################ DNS #################
  - tag: forward_remote
    type: forward
    args:
      concurrent: 2
      upstreams:
        - addr: "https://dns.google/dns-query"
          socks5: "127.0.0.1:7891"
        - addr: "https://cloudflare-dns.com/dns-query"
          socks5: "127.0.0.1:7891"
        - addr: "https://dns.quad9.net/dns-query"
          socks5: "127.0.0.1:7891"
        - addr: "https://dns.opendns.com/dns-query"
          socks5: "127.0.0.1:7891"
        - addr: "https://dns.adguard-dns.com/dns-query"
          socks5: "127.0.0.1:7891"
  
  - tag: forward_local
    type: forward
    args:
      concurrent: 3
      upstreams:
        # ali doh dot h3
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "223.6.6.6"
        - addr: "tls://dns.alidns.com"
          dial_addr: "2400:3200:baba::1"
          enable_pipeline: false # ali dot 不支持 pipeline
        - addr: "tls://dns.alidns.com"
          dial_addr: "223.5.5.5"
          enable_pipeline: false
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "223.5.5.5"
          enable_http3: true
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "2400:3200::1"
          enable_http3: true
        # dnspod doh dot
        - addr: "https://doh.pub/dns-query"
          dial_addr: "1.12.12.12"
        - addr: "https://doh.pub/dns-query"
          dial_addr: "120.53.53.53"
        - addr: "tls://dot.pub"
          dial_addr: "1.12.12.12"
          enable_pipeline: true
        - addr: "tls://dot.pub"
          dial_addr: "120.53.53.53"
          enable_pipeline: true

  - tag: forward_openclash
    type: forward
    args:
      concurrent: 1
      upstreams:
        - addr: 127.0.0.1:7874

  ################# 缓存 ################

  # # 缓存 lan
  # - tag: cache_lan
  #   type: cache
  #   args:
  #     size: 8192
  #     lazy_cache_ttl: 86400
  # # 缓存 wan
  # - tag: cache_wan
  #   type: cache
  #   args:
  #     size: 131072
  #     lazy_cache_ttl: 86400

  ################# TTL 覆写 ################
  - tag: ttl_modify
    type: "sequence"
    args:
      exec: ttl 3600-86400


  ################# 其他插件 ################
  # 附加 ecs cn 信息
  - tag: ecs_cn
    type: "ecs_handler"
    args:
      forward: true # 是否转发来自下游的 ecs (在adguardhome中设置)
      send: true # 是否发送 ecs
      mask4: 24 # ipv4 掩码。默认 24
      mask6: 48 # ipv6 掩码。默认 48

  # 禁用 ECS
  - tag: no_ecs
    type: "ecs_handler"
    args:
      forward: false # 是否转发来自下游的 ecs
      preset: "" # 发送预设 ecs
      send: false # 是否发送 ecs
      mask4: 24
      mask6: 48 
